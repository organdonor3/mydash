<!DOCTYPE HTML>
<html>
	<head>
		
		  <meta name="description" content="MCSD User Dashboard">
      <meta name="keywords" content="Dashboard">
      <meta name="author" content="MCSD Dev">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <meta http-equiv="content-language" content="en-us">
      <meta http-equiv="cleartype" content="on">
      
		<title>MyDash</title>

		  <!-- Bootstrap -->
      <link href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">
      <link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
      <link href="css/bootstrap-theme-dash.css" rel="stylesheet">
      
      <!-- Full Calendar -->
      <link href='http://cdnjs.cloudflare.com/ajax/libs/fullcalendar/1.6.4/fullcalendar.css' rel='stylesheet' />
			<link href='http://cdnjs.cloudflare.com/ajax/libs/fullcalendar/1.6.4/fullcalendar.print.css' rel='stylesheet' media='print' />
			
			<!-- Datatables -->
			<link href='http://cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/css/jquery.dataTables.min.css'>

			<!-- Gridster -->
			<link href='http://cdnjs.cloudflare.com/ajax/libs/jquery.gridster/0.2.1/jquery.gridster.min.css' rel='stylesheet' />
			
			<!-- menu -->
			<link href="css/jPushMenu.css" rel="stylesheet">
      
      <!-- Google Web Fonts -->
      <link href='http://fonts.googleapis.com/css?family=Monda' rel='stylesheet' type='text/css'>
      
      <!-- Dash Styles -->
      <link href="css/dash.css" rel="stylesheet">
      <link href="css/clock.css" rel="stylesheet">
      
	</head>
	<body>
		
		<!-- Right menu element-->
		<nav class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-right">
			<h3>Widgets</h3>
			
		</nav>
				
		<button type="button" class="toggle-menu menu-right menu-button">
      <i class="fa fa-lg fa-bars"></i>
    </button>
    
		<!-- NAVIGATION MENU 

    <div class="navbar-nav navbar-inverse navbar-fixed-top">
        <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html"><i class="icon icon-user"></i> MyDash</a>
        </div> 
          <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li><a href="index.html"><i class="fa fa-user fa-lg"></i> User Info</a></li>
              <li><a href="manager.html"><i class="fa fa-bar-chart-o fa-lg"></i> Reporting</a></li>
              <li><a href="calendar.html"><i class="fa fa-calendar fa-lg fa-fw"></i> Calendar</a></li>

            </ul>
          </div>
        </div>
    </div>
    
   -->

   
    	
    	
    	<div class="gridster">
		    <ul></ul>
		</div>



	  <!-- JQuery -->
 		<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
 		<script src="http://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
 		<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.11.1/jquery.validate.min.js"</script>
 			
 		<!-- Bootstrap -->
		<script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/js/bootstrap.min.js"></script>
		
		<!-- Modernizer -->
		<script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.7.1/modernizr.min.js"></script>
		
		<!-- Highchart -->
		<script src="http://cdnjs.cloudflare.com/ajax/libs/highcharts/3.0.9/highcharts.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/highcharts/3.0.9/modules/exporting.js"></script>
    
		<!-- Full Calendar -->
    <script src='http://cdnjs.cloudflare.com/ajax/libs/fullcalendar/1.6.4/fullcalendar.js'></script>
		<script src='http://cdnjs.cloudflare.com/ajax/libs/fullcalendar/1.6.4/gcal.js'></script>
			
		<!-- Gridster -->
    <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery.gridster/0.2.1/jquery.gridster.min.js'></script>
    
    <!-- DataTables -->
		<script src="http://cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/jquery.dataTables.min.js"></script>
		
		<!-- Moment.js -->
		<script src="http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.0.0/moment.min.js"></script>
		
		<!-- JQuery Cookies -->
		<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.0/jquery.cookie.min.js"></script>
		
 		<!-- dlmenu -->
		<script src="js/jPushMenu.js"></script>
 		
	
	<!-- LOCAL
	  <script type="text/javascript" src="js/jquery.min.js"></script>
		<script type="text/javascript" src="js/highcharts.js"></script>
		<script type="text/javascript" src="js/modules/exporting.js"></script>
		
	-->
		
	<script type="text/javascript">
	
	
		/*Gridster */
		var widgets;
    var gridster;
    
    var removeWidget = function(id){
    	alert(id);
    };
    
    var saveGrid = function(){
    	var s = gridster.serialize();
    	$.each(s, function(i, newWidget){
    		var updateWidget = $.grep(widgets, function(wgt){ return wgt.id == newWidget.id; });
    		updateWidget[0].col = newWidget.col;
				updateWidget[0].row = newWidget.row;
				updateWidget[0].size_x = newWidget.size_x;
				updateWidget[0].size_y = newWidget.size_y;
    	});
    	//save to cookie
    	$.cookie("layout", JSON.stringify(widgets), { expires: 9999 });
			
    	//alert(JSON.stringify(widgets));
		};
		
		/*
    var saveWidget = function(newWidget){
    	//find widget in list by using the id of the li
			var updateWidget = $.grep(widgets, function(wgt){ return wgt.id == newWidget.attr('id'); });
			
			//returns array of 1 object, update positional data
			updateWidget[0].col = newWidget.coords().grid.col;
			updateWidget[0].row = newWidget.coords().grid.row;
			updateWidget[0].size_x = newWidget.coords().grid.size_x;
			updateWidget[0].size_y = newWidget.coords().grid.size_y;
			
      //save to cookie
    	$.cookie("layout", JSON.stringify(widgets));
			
    	alert(JSON.stringify(widgets));
		};
		*/
		
    var loadGrid = function(){
    	
			if($.cookie("layout")){
    		//saved layout
    		//alert($.cookie("layout"));
    		widgets = JSON.parse($.cookie("layout"));
    	}
    	else{
    		//default layout
    		jQuery.ajax({
    			dataType: "json",
			    url: "widgets/all.json",
			    success: function( data ) {
	      		widgets = data;
			    },
			    async:false
			  })
			  
    	}
    
      gridster.remove_all_widgets();
      $.each(widgets, function(i, widget){
      	jQuery.ajax({
      		dataType: "html",
			    url: widget.src,
			    success: function( data ) {
	      		gridster.add_widget.apply(gridster, [data, widget.size_x, widget.size_y, widget.col, widget.row]);
			    },
			    async:true
			  })
		  });
			  /*
      	$.get( widget.src, function( data ) {
	      	gridster.add_widget.apply(gridster, [data, widget.size_x, widget.size_y, widget.col, widget.row]);
				  //alert( "Data Loaded: " + data );
				});
				*/
      
      
    };
    
    
    //reload grid on window resize
    var resizeTime;
		$( window ).resize(function() {
			clearTimeout(resizeTime);
  		resizeTime = setTimeout(function() {
  				//loadGrid();
	    }, 200);
		});


		var loadMenu = function(){
			jQuery.ajax({
    			dataType: "json",
			    url: "widgets/all.json",
			    success: function( data ) {
	      		$.each(data, function(i, widget){
			      	$("nav").append( "<a href='#'>" + widget.id + "</a>" );
					  });
			    },
			    async:false
			 });
		  $('.toggle-menu').jPushMenu();
		};
    
    $(document).ready(function(){
    	
    	
    	//initialize gridster
    	gridster = $(".gridster ul").gridster({
	        widget_margins: [4, 4],
	        widget_base_dimensions: [120, 120],
	        serialize_params: function($w, wgd) { 
              return { 
                     id: $($w).attr('id'), 
                     col: wgd.col, 
                     row: wgd.row, 
                     size_x: wgd.size_x, 
                     size_y: wgd.size_y 
              };
          },
	        draggable: {
	        	stop: function(e, ui) {
            	saveGrid();
	          }
	        },
	        resize: {
	        	enabled: true,
	        	stop: function(e, ui, $widget) {
	        		//force refresh widget content on resize
	        		$widget.find('.refresh-widget').click();
	        		saveGrid();
	        		//saveWidget(ui.$player);
	            //alert('STOP position: ' + ui.position.top +' '+ ui.position.left);
	          }
	        }
	    }).data('gridster');
	    
	    /*
    	gridster.$el
        .on('mouseenter', '> li', function() {
            gridster.resize_widget($(this), 3, 3);
        })
        .on('mouseleave', '> li', function() {
            gridster.resize_widget($(this), 1, 1);
        });
			*/
	    
  	  loadGrid();
  	  loadMenu();
			
				
    });
    

		</script>
		
		
	</body>
</html>
